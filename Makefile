CC = gcc

CFLAGS = -Os -g -Wall -std=c11

CPPFLAGS = -DPROPERGATE

all:
	$(CC) stub.c -o stub $(CFLAGS) $(CPPFLAGS)
	strip --strip-all stub
	du -b stub
	sed -i "s/#define STUB_SIZE [0-9]\+/#define STUB_SIZE $$(du -b stub | cut -f1)/" stub.c
	$(CC) stub.c -o stub $(CFLAGS) $(CPPFLAGS)
	strip --strip-all stub
	du -b stub
